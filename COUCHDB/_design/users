{
   "_id": "_design/users",
   "views": {
       "short": {
           "map": "function(doc){
           					var obj = {userid: doc._id, firstname: doc.firstname, lastname: doc.lastname, username: doc.username, picture_file: doc.picture_file, intro:doc.intro};
           					if (doc.type == 7) emit(doc._id, obj);
           				}"
       },
       "searchbyid": {
           "map": "function(doc){
           					var obj = {userid: doc._id, firstname: doc.firstname, lastname: doc.lastname, username: doc.username, intro: doc.intro};
           					if (doc.type == 7) emit(doc._id, obj);
           				}"
       },
       "searchbyusername": {
           "map": "function(doc){
           					var obj = {userid: doc._id, firstname: doc.firstname, lastname: doc.lastname, username: doc.username, intro: doc.intro};
           					if (doc.type == 7) emit(doc.username.toLowerCase(), obj);
           				}"
       },
       "username": {
           "map": "function(doc){
           					if (doc.type == 7) emit(doc.username.toLowerCase(), doc._id);
           				}"
       },
       "login": {
           "map": "function(doc){
           					if (doc.type == 7) emit(doc._id);
           				}"
       },
       "tomail": {
           "map": "function(doc){
           					if (doc.type == 7){
           						var obj = {userid: doc._id, firstname: doc.firstname, lastname: doc.lastname, username: doc.username};
           						emit(doc.username.toLowerCase(), obj); 
           						emit(doc._id, obj);
           					}
           				}"
       },
       "leaderboard": {
           "map": "function(doc){
           					if (doc.type == 7 && doc.ip>=0){
           						var obj={};
           						obj.userid=doc._id;
           						obj.ip=doc.ip;
           						obj.username = doc.username; 
           						emit(doc.ip,obj);
           					}
           				}"
       },
       "count": {
           "map": "function(doc){
           					if (doc.type == 7) emit(doc._id);
           				}",
           "reduce": "_count"
       },
       "online": {
           "map": "function(doc){
           					if (doc.type == 7 && doc.online) emit(doc._id);
           				}"
       },
       "sockets": {
           "map": "function(doc){
           					if (doc.type == 7 && doc.sock) emit(doc.sock, doc._id);
           				}"
       }
   },
   "validate_doc_update": "function (newDoc, oldDoc, userCtx) {
   												log(userCtx.name);
   												if (newDoc.type == 7 && newDoc._id != userCtx.name && userCtx.roles.indexOf('_admin')<0){
   													throw({forbidden:'You may only update documents with author '+userCtx.name });
   												}
   												if(newDoc.type == 7 && oldDoc && oldDoc.ip != newDoc.ip && userCtx.roles.indexOf('_admin')<0){
   													throw({forbidden:'You may not alter user score'+ userCtx.name });
   												}
   											}",
   "language": "javascript"
}