/*
 * https://github.com/IDEAFY/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY LLC
 */

define(["OObject","service/map","service/submenu","Amy/Stack-plugin","Bind.plugin","service/config","Store","service/utils","./ideafy-menu","./quickb/quickb","./multi/mub"],function(e,t,a,s,i,n,o,l,c,d,r){return function(){var l,u=new e,p=new o,m=new s;return n.get("user"),u.plugins.addAll({brainstormstack:m,header:new i(p,{setDate:function(e){e&&(this.innerHTML=e.toLocaleDateString())},setTime:function(e){var t=e.getHours(),a=e.getMinutes(),s=e.getSeconds();10>t&&(t="0"+t),10>a&&(a="0"+a),10>s&&(s="0"+s),this.innerHTML=t+":"+a+":"+s}})}),u.template='<div id="brainstorm"><div id="brainstorm-menu"></div><div class="brainstorm-header header blue-dark"><div class="date" data-header="bind: setDate, date"></div><span class="headerTitle" data-header="bind: innerHTML, headertitle"></span><div class="clock" data-header="bind: setTime, date">hh:mm</div></div><div class="stack" data-brainstormstack="destination"></div></div>',u.place(t.get("brainstorm")),u.showMenu=function(){l.toggleActive(!0)},u.hideMenu=function(){l.toggleActive(!1)},u.exitSession=function(){m.getStack().show("menu"),n.get("observer").notify("session-exited")},u.reset=function(){m.getStack().get("menu").reset(),m.getStack().show("menu")},u.selectScreen=function(e,t){if("continue"===e&&(e=t.type),"tutorial"!==e&&m.getStack().get(e))m.getStack().get(e).reset(t),m.getStack().show(e);else{switch(t?e=t.type:t=null,e){case"quick":m.getStack().add("quick",new d(t,u.exitSession));break;case"musession":m.getStack().add("musession",new r(t,u.exitSession));break;case"tutorial":n.get("observer").notify("display-tutorials");break;default:e=""}e&&m.getStack().show(e)}},l=new a(u.dom.querySelector("#brainstorm-menu")),l.toggleActive(!1),p.set("headertitle",n.get("labels").get("brainstormheadertitle")),setInterval(function(){var e=new Date;p.set("date",e)},1e3),m.getStack().add("menu",new c(u.selectScreen)),m.getStack().show("menu"),n.get("observer").watch("replay-session",function(e){var t={};t.id=e,e.toLowerCase().search("quick")>-1&&(t.type="quick"),e.toLowerCase().search("s:mu")>-1&&(t.type="musession"),u.selectScreen(t.type,t)}),n.get("observer").watch("join-musession",function(e){var t={type:"musession",id:e,mode:"join"};u.selectScreen(t.type,t)}),n.get("observer").watch("show-mupreview",function(e){var t={type:"musession",id:e,mode:"preview"};u.selectScreen(t.type,t)}),u}});