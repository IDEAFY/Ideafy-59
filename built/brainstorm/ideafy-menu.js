/**
 * https://github.com/IDEAFY/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY LLC
 */

define(["OObject","service/map","Store","Bind.plugin","Event.plugin","service/config"],function(e,t,a,s,i,n){return function(o){var l=new e,c=n.get("user"),d=n.get("labels"),r=new a,u={name:"continue",active:!0,selected:!1,label:d.get("continuesession"),bg:"continuesession.png",bgselected:"continueactive.png"},g="";return l.plugins.addAll({ideafymenu:new s(r,{setActive:function(e){e?this.classList.remove("inactive"):this.classList.add("inactive")},setBg:function(e){var t=this.getAttribute("data-ideafymenu_id");e?this.setAttribute("style","background-image:url('img/brainstorm/"+r.get(t).bgselected+"');color:white;"):this.setAttribute("style","background-image:url('img/brainstorm/"+r.get(t).bg+"');color:#4D4D4D;")}}),labels:new s(d),ideafyevent:new i(this)}),l.template='<div id="ideafy-menu"><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, brainstormchoosemode"></div><ul class="menu" data-ideafymenu = "foreach"><li data-ideafymenu="bind:innerHTML, label; bind: setActive, active; bind:setBg, selected" data-ideafyevent="listen:mousedown, press; listen: mouseup, start"></li></ul></div>',l.place(t.get("ideafy-menu")),this.press=function(e,t){var a=t.getAttribute("data-ideafymenu_id");r.update(a,"selected",!0),t.classList.add("pressed")},this.start=function(e,t){var a=t.getAttribute("data-ideafymenu_id");"continue"===r.get(a).name?o("continue",g):o(r.get(a).name),t.classList.remove("pressed"),r.update(a,"selected",!1)},l.addContinue=function(e){var t=JSON.parse(r.toJSON());"continue"!==r.get(0).name&&(t.unshift(u),r.reset(t)),g=e},l.removeContinue=function(){var e=JSON.parse(r.toJSON());"continue"===e[0].name&&e.splice(0,1),r.reset(e),g=""},l.reset=function(){r.reset([{name:"quick",active:!0,selected:!1,label:d.get("quickbmode"),bg:"quick.png",bgselected:"quickactive.png"},{name:"musession",active:!0,selected:!1,label:d.get("musession"),bg:"multiuser.png",bgselected:"multiuseractive.png"},{name:"customb",active:!1,selected:!1,label:d.get("customsession"),bg:"customb.png",bgselected:"custombactive.png"},{name:"tutorial",active:!0,selected:!1,label:d.get("ideafytutorial"),bg:"tutorial.png",bgselected:"tutorialactive.png"}]),c.get("sessionInProgress")&&c.get("sessionInProgress").id&&l.addContinue(c.get("sessionInProgress"))},l.reset(),c.watchValue("sessionInProgress",function(e){e.id&&e.type?l.addContinue(e):l.removeContinue()}),c.watchValue("lang",function(){var e=n.get("labels");r.loop(function(t,a){switch(t.name){case"continue":r.update(a,"label",e.get("continuesession"));break;case"quick":r.update(a,"label",e.get("quickbmode"));break;case"musession":r.update(a,"label",e.get("musession"));break;case"customb":r.update(a,"label",e.get("customsession"));break;case"tutorial":r.update(a,"label",e.get("ideafytutorial"))}})}),l}});