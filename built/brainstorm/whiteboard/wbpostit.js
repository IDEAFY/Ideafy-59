/*
 * https://github.com/IDEAFY/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY LLC
 */

define(["OObject","Store","Bind.plugin","Event.plugin","service/config"],function(e,t,s,i,n){return function(a,o){var r=new e,c=n.get("labels"),d="#4D4D4D",l=[{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}],u=new t(l),p=null,g=new t({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"},author:n.get("user").get("_id")});return r.plugins.addAll({labels:new s(c),postit:new s(g,{setStyle:function(e){var t=e.marker,s=e.img;this.setAttribute("style","background-image:url('img/brainstorm/"+s+"'); color:"+t+";")}}),colors:new s(u,{setBg:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),postitevent:new i(r)}),r.template='<div class="wbpostit"><div class="postit-cancel postit-close" data-postitevent="listen:mousedown,cancel"></div><div class="postit" data-postit="bind:setStyle, style"><textarea data-postit="bind: value, content"></textarea></div><span class="choosecolorlbl" data-labels="bind:innerHTML, choosecolorlbl"></span><ul class="postitcolors" data-colors="foreach"><li class="postitcolor" data-postitevent="listen:mousedown,choose" data-colors="bind:setBg, color;bind:setSelected, selected"></li></ul><div name="post" class = "postpostit" data-postitevent="listen: mousedown, press; listen:mouseup, post"></div><div class = "delpostit" name="del" data-postitevent="listen:mousedown, press;listen:mouseup, del"></div></div>',r.cancel=function(){o("postit")},r.choose=function(e,t){var s=t.getAttribute("data-colors_id");u.loop(function(e,t){t===parseInt(s,10)?u.update(t,"selected",!0):u.update(t,"selected",!1)}),g.set("style",{postit:u.get(s).name,marker:d,img:u.get(s).img})},r.press=function(e,t){r.dom.querySelector("textarea").blur(),t.classList.add("pressed")},r.post=function(e,t){p||0===p?a.alter("splice",p,1,JSON.parse(g.toJSON())):a.alter("push",JSON.parse(g.toJSON())),t.classList.remove("pressed"),o("postit"),r.reset()},r.reset=function(e){p=e,p||0===p?g.reset(a.get(p)):(g.reset({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"},author:n.get("user").get("_id")}),u.reset([{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}]))},r.del=function(e,t){p&&a.del(p),t.classList.remove("pressed"),r.reset(),o("postit")},r}});