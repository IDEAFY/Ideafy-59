/*
 * https://github.com/IDEAFY/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY LLC
 */

define(["OObject","service/config","Store","Bind.plugin","Event.plugin","twocents/writetwocent","twocents/twocentlist","service/avatar","service/utils","Place.plugin"],function(e,t,s,i,n,a,o,r,c,l){return function(){var d,u=new e,p=t.get("labels"),g=t.get("user"),m=new s,v=new a("connect"),b=new o("connect");return u.plugins.addAll({labels:new i(p),tqdetail:new i(m,{setHeader:function(e){this.innerHTML=e?e===g.get("_id")?p.get("mytqdetailheader"):p.get("tqheaderprefix")+m.get("username")+p.get("tqheadersuffix"):p.get("selecttq")},displayWriteTwocent:function(e){e&&e!==g.get("_id")?this.classList.remove("invisible"):this.classList.add("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("connect-writetwocents").classList.add("invisible")},displayTwocentNB:function(e){var t=e.length||0;this.innerHTML=t?1===t?t+" "+p.get("showonetcreply"):t+p.get("showtcrepliesafter"):p.get("noreplyyet")},date:function h(h){h&&(this.innerHTML=c.formatDate(h))},setAuthor:function(e){this.innerHTML=e===g.get("username")&&m.get("author")===g.get("_id")?p.get("youlbl"):e},setWrotelbl:function(e){this.innerHTML=e===g.get("_id")?p.get("youwrotelbl"):p.get("ideawrotelbl")},setAvatar:function(e){var t=document.createDocumentFragment(),s=new r([e]);s.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)}}),place:new l({TwoQTwocentList:b}),tqevent:new n(u)}),u.template='<div class="twocent-detail"><div class="header blue-dark"><span data-tqdetail="bind: setHeader, author"></span></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-tqdetail="bind:setAvatar, author"></div><span class="author" data-tqdetail="bind:setAuthor,username"></span><span class="commentlbl" data-tqdetail="bind: setWrotelbl, author"></span><p data-tqdetail="bind:innerHTML,question"></p><span class="date" data-tqdetail="bind:date, creation_date"></span></div><div class="detail-body"></div><div class="detail-footer"><div class="tcbutton" data-tqevent="listen:mousedown, press; listen: mouseup, write"></div><div class="tcreplies" data-tqdetail = "bind: displayTwocentNB, twocents"></div></div><div id="connect-writetwocents" class="invisible" data-tqdetail="bind: displayWriteTwocent, author"></div><div id="connect-twocents" class="twocents" data-tqdetail="bind: displayTwocentList, twocents" data-place="place:TwoQTwocentList"></div></div></div>',u.press=function(e,t){t.classList.add("pressed")},u.write=function(e,t){t.classList.remove("pressed"),document.getElementById("connect-writetwocents").classList.remove("invisible")},u.hide=function(){document.querySelector(".detail-contents").classList.add("invisible"),m.reset({})},u.reset=function(e){m.reset(e.value),v.reset(m.get("_id")),b.reset(m.get("_id")),d=u.dom.querySelector("#connect-writetwocents"),v.place(d)},u.place(document.createDocumentFragment()),u}});