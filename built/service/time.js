/**
 * https://github.com/IDEAFY/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY LLC
 */

define(["OObject","Bind.plugin","Event.plugin","service/config","Store","service/utils"],function(e,t,i,n,s){function a(){var e=this,a=n.get("labels"),o=n.get("user"),r=new s({hour:0,min:0,am:!0});e.plugins.addAll({label:new t(a),model:new t(r,{setAMPM:function(e){this.selectedIndex=e?0:1}}),user:new t(o,{displayAMPM:function(e){switch(e){case"fr-fr":this.classList.add("invisible");break;default:this.classList.remove("invisible")}}}),event:new i(this)}),e.template='<div class = "timeui"><div class="timeicon"></div><input type="number" maxlength="2" max="23" name="hour" data-model="bind:value, hour" data-event="listen:blur, format"><span>:</span><input type="number" maxlength="2" max="59" name="min" data-model="bind:value, min" data-event="listen:blur, format"></select><select name="am" class="invisible" data-model="bind:setAMPM, am" data-user="bind:displayAMPM, lang" data-event="listen: change, setAMPM"><option>AM</option><option>PM</option></select></div>',e.getTime=function(){var e,t=r.get("min");return e=r.get("am")?r.get("hour"):parseInt(r.get("hour"))+12,[e,t,0]},e.format=function(e,t){var i=t.value,n=t.getAttribute("name");isNaN(i)?r.set(n,"00"):10>i&&i.length<2&&(t.value="0"+i),"hour"===n&&i>23&&r.set(n,"00"),"min"===n&&i>59&&r.set(n,"00")},e.setAMPM=function(e,t){1===t.selectedIndex?r.set("am",!1):r.set("am",!0)},e.getTimestamp=function(){var e,t=parseInt(r.get("min"),10)||0;return e=r.get("am")?parseInt(r.get("hour"),10):parseInt(r.get("hour"),10)+12,1e3*(3600*e+60*t)},e.setTime=function(e,t,i){var n=new Date,s=o.get("lang"),a=e||n.getHours(),l=t||n.getMinutes();switch(10>l?r.set("min","0"+l):r.set("min",l),a>11?r.set("am",!1):r.set("am",!0),s){case"fr-fr":r.set("hour",a);break;default:12>a?r.set("hour",a):r.set("hour",a%12)}},e.updateNow=function(t,i){i.checked&&e.reset()},e.reset=function(){e.setTime()},e.render(),e.reset()}return function(){return a.prototype=new e,new a}});