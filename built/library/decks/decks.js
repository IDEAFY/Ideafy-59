/*
 * https://github.com/IDEAFY/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY LLC
 */

define(["OObject","Bind.plugin","Amy/Stack-plugin","Amy/Control-plugin","Event.plugin","Place.plugin","service/config","service/map","./decklist/decklist","./deckview/deckview","./newdeck"],function(e,t,n,i,s,a,o,r,c,l,d){return function(){var r,u,p,h=new e,g=new i(h),m=o.get("user"),f=new n,v=function(e){var t=f.getStack().getCurrentScreen(),n=t.getModel();r=t.highlightDeck(g.init,e),y.reset(n.get(r))},b=!1,w=function(e,t,n){var i;p=t,"new"===e&&(b=!0,p=t),"updated"===e&&(i=f.getStack().getCurrentScreen(),i.reset(function(e){e&&(i.highlightDeck(g.init,t),y.reset(i.getModel().get(r),n))}))},y=new l(w),L=new d(w);return h.plugins.addAll({label:new t(o.get("labels")),deckliststack:f,decksevent:new s(h),deckplace:new a({deckView:y,newDeck:L}),deckscontrol:g}),h.template='<div id="decks"><div id="decklist" class="list"><div class="header blue-light"><div class="option left" data-deckscontrol=""></div><span data-label="bind: innerHTML, decklistheadertitle"></span><div class="option right" data-decksevent="listen: mousedown, plus"></div></div><div class="overflow" data-deckliststack="destination" data-deckscontrol="radio:li,selected,mousedown,selectStart"></div></div><div data-deckplace="place:deckView"></div><div data-deckplace="place:newDeck"></div></div>',h.reset=function(){u.reset(function(e){e&&(f.getStack().show("ideafy"),u.highlightDeck(g.init,0),y.reset(u.getModel().get(0)),r=0)})},h.displayDeck=v,h.init=function(){u=new c("all_decks"),f.getStack().add("ideafy",u),u.init(function(e){e&&(f.getStack().show("ideafy"),y.init(),u.highlightDeck(g.init,0),y.reset(u.getModel().get(0),"details"),r=0)})},h.selectStart=function(e){var t=f.getStack().getCurrentScreen().getModel(),n=e.target.getAttribute("data-decks_id");y.reset(t.get(n)),r=n},h.plus=function(){L.show()},h.init(),m.watchValue("lang",function(){var e,t=f.getStack().getCurrentName(),n=f.getStack().getCurrentScreen();switch(t){case"taiaut":e="taiaut_decks";case"custom":e="custom_decks";break;default:e="all_decks"}n.getDecks(e,function(e){e&&(n.initSelected(g.init,r),y.reset(n.getModel().get(r)))})}),m.watchValue("custom_decks",function(e,t,n){u.reset(function(t){var i;t&&b?v(p):t&&e.length<n.length&&(i=u.getModel(),i.getNbItems()&&(u.initSelected(g.init,0),y.reset(i.get(0)),r=0)),b=!1})}),m.watchValue("taiaut_decks",function(){u.reset(function(e){e&&(u.initSelected(g.init,0),y.reset(u.getModel().get(0)))})}),h}});