/**
 * https://github.com/IDEAFY/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY LLC
 */

define(["OObject","service/map","Amy/Stack-plugin","Bind.plugin","./detail-stack/library-idea","./detail-stack/library-edit","./detail-stack/library-sendmail","./detail-stack/library-share","service/config","Store","lib/spin.min"],function(e,t,n,i,s,a,o,r,c,l,d){return function(){var t,u,p,g,h=new e,m=new e,f=new n,v=c.get("observer"),b=c.get("labels"),w=new l,y=0,L=new d({color:"#808080",lines:10,length:12,width:6,radius:10,top:328}).spin();return h.plugins.addAll({detailstack:f}),h.template='<div class="detail-stack" data-detailstack="destination"></div>',m.template='<div class="msgsplash"><div class="header blue-dark"><span data-labels="bind:innerHTML, noideafound"></span></div><div class="innersplash"><span data-labels="bind: innerHTML, tryotherview"></span></div></div>',m.plugins.add("labels",new i(b)),h.reset=function(e,n){var i;w=e,y=n,f.getStack().show("#library-ideadetail"),t.hideCache(),L.spin(h.dom),t.reset(e,n).then(function(){L.stop(),i.classList.add("invisible")})},h.action=function(e){switch(e){case"#library-edit":g.reset(w.get(y).id),f.getStack().show("#library-edit");break;case"#library-favorites":break;case"#library-share":p.reset(w.get(y).id),f.getStack().show("#library-share");break;case"close":f.getStack().show("#library-ideadetail"),L.spin(h.dom),t.refresh().then(function(){L.stop()});break;default:f.getStack().show("#library-ideadetail")}},h.edit=function(e){g.reset(e),f.getStack().show("#library-edit")},h.sendMail=function(e){u.reset(e),f.getStack().show("#library-sendmail")},h.share=function(e){p.reset(e._id),f.getStack().show("#library-share")},h.displayEmpty=function(){f.getStack().show("#empty-list")},t=new s(h.action),g=new a(h.action),u=new o(h.action),p=new r(h.action),f.getStack().add("#library-ideadetail",t),f.getStack().add("#library-edit",g),f.getStack().add("#library-sendmail",u),f.getStack().add("#library-share",p),f.getStack().add("#empty-list",m),v.watch("library-viewidea",function(e){h.viewIdea(e)}),v.watch("library-edit",function(e){h.edit(e)}),v.watch("library-sendmail",function(e){h.sendMail(e)}),v.watch("library-share",function(e){h.share(e)}),h}});